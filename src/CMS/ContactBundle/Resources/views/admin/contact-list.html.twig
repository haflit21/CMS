{% extends('::admin.html.twig') %}

{% block body %}

	<div class="row-fluid">

		<div class="span12">
			{% for flashMessage in app.session.flashbag.get('info') %}
			    <div class="alert alert-info">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Notice</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}
			{% for flashMessage in app.session.flashbag.get('error') %}
			    <div class="alert alert-error">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Error</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}
			<table class="table table-striped table-hover">
	            <thead>
	                <tr>
	                  	<th>#</th>
	                  	<th>{% trans %}Lastname{% endtrans %} {% trans %}Firstname{% endtrans %}</th>
	                  	<th>{% trans %}Sender{% endtrans %}</th>
	                  	<th>{% trans %}subject{% endtrans %}</th>
	                  	<th>{% trans %}message{% endtrans %}</th>
	                  	<th>{% trans %}Created{% endtrans %}</th>
	                  	<th class="center-text">{% trans %}Status{% endtrans %}</th>
	                  	<th class="center-text" colspan="2">{% trans %}Actions{% endtrans %}</th>
	                </tr>
	            </thead>
	            <tbody>
	              	{% for message in messages %}
					<tr id="row-{{ message.id }}">
						<td>{{ message.id }}</td>
						<td>{{ message.lastname }} {{ message.firstname }}</td>
						<td>{{ message.sender }}</td>
						<td>{{ message.subject }}</td>
						<td>{{ message.message|truncate(50, '...') }}</td>
						<td>{{ message.created|date('d/m/Y') }}</td>
						<td class="center-text" id="col-{{ message.id }}">
							{% if message.statut %}
								<a href="#" data-toggle="tooltip" data-placement="top" title="Lu" class="icon-ok tooltip-link"></a>
							{% else %}
								<a href="#" data-toggle="tooltip" data-placement="top" title="Non Lu" class="icon-remove tooltip-link"></a>
							{% endif %}
						</td>
						<td>
							<a href="javascript:showMessage({{ message.id }});" class="icon-zoom-in"></a>

						</td>
						<td>
							<a href="#myModal-{{ message.id }}" data-toggle="modal" class="icon-trash"></a>
							<div class="modal hide" id="myModal-{{ message.id }}">
								<div class="modal-header">
							    	<button type="button" class="close" data-dismiss="modal">×</button>
							    	<h3>Suppression du message ?</h3>
							    </div>
							    <div class="modal-body">
							    	<p>Voulez-vous supprimer ce message ?</p>
							    </div>
							    <div class="modal-footer">
							    	<a href="#" class="btn" data-dismiss="modal">Non</a>
							    	<a href="{{ path('contacts_delete', { 'id' : message.id }) }}" class="btn btn-primary">Oui</a>
							    </div>
							</div>
						</td>
					</tr>
					{% endfor %}
				</tbody>
				<tfoot>
					<tr>
						<td>{% trans %}Total{% endtrans %} : {{ messages|length }} {% trans %}message(s){% endtrans %}</td>
					</tr>	
				</tfoot>
			</table>
		</div>
	</div>
	<div class="modal hide" id="modalItem">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">×</button>
			<h3 id="titleModalItem"></h3>
		</div>
		<div class="modal-body">
		</div>
		<div class="modal-footer">
	    	<a href="#" class="statut btn btn-primary">Marquer comme lu</a>
	    </div>
	</div>
{% endblock body %}
{% block javascripts %}
<script type="text/javascript">
	function showMessage(id) {
		$.ajax({
			url: "/admin/contacts/item/" + id,
			dataType:'json',
			success: function(msg) {
				$('#titleModalItem').html(msg.subject);
				$('#modalItem .modal-body').html('<ul class="unstyled"><li>' + msg.from + '</li><li>' + msg.message + '</li></ul>');
				$('#modalItem a.statut').attr('href', '/admin/contacts/statut/'+msg.id);
				$('#modalItem').modal('show');

			}
		})
	}

		$('.tooltip-link').hover(function() {
			$(this).tooltip('toggle');
		});
</script>
{% endblock javascripts %}
