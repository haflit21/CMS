{% extends '::admin.html.twig' %}
{% block title "Dashboard" %}

{% block body %}
<div class="row-fluid">
	<div class="span12">
		<div class="span4 actions_dashboard">
			<div class="widget-header">
				<h5>{% trans %}Contents{% endtrans %}</h5>
			</div>
			<a href="{{ path('contents') }}">
				<span class="li_note">&nbsp;</span>
			</a>
			
			<div class="stats">
				<div class="span6 first">
					<span class="nb" id="nb_content"></span><br />
					{% trans %}contents{% endtrans %}
				</div>
				<div class="span6">
					<span class="nb" id="nb_categories"></span><br />
					{% trans %}categories{% endtrans %}
				</div>
			</div>
		</div>
		<div class="span4 actions_dashboard">
			<div class="widget-header">
				<h5>{% trans %}Messages{% endtrans %}</h5>
			</div>
			<a href="{{ path('contacts_list') }}">
				<span class="li_stack">&nbsp;</span>
			</a>
			
			<div class="stats">
				<div class="span6 first">
					<span class="nb" id="unread"></span><br />
					{% trans %}unread{% endtrans %}
				</div>
				<div class="span6">
					<span class="nb" id="read"></span><br>
					{% trans %}messages{% endtrans %}
				</div>	
			</div>
		</div>
		<div class="span4 actions_dashboard">
			<div class="widget-header">
				<h5>{% trans %}Medias{% endtrans %}</h5>
			</div>
			<a href="{{ path('medias') }}">
				<span class="li_camera">&nbsp;</span>
			</a>
			
			<div class="stats">
				<div class="span6 first">
					<span class="nb">10</span><br>
					{% trans %}images{% endtrans %}
				</div>
				<div class="span6">
					<span class="nb">20</span><br>
					{% trans %}medias{% endtrans %}
				</div>		
			</div>
		</div>
		
	</div>
</div>

<div class="h20 clearfix"></div>
<div class="row-fluid">
	<div class="span12">
		<div class="span4 actions_dashboard">
			{% render "CMSDashboardBundle:Agenda:index" with {'year':year, 'month': month } %}
		</div>
		<div class="span4 actions_dashboard">
			<div class="widget-header">
				<h5>{% trans %}Statistiques{% endtrans %}</h5>
			</div>
			<div class="stats">
				<canvas id="chartMsg" width="285px" height="142px"></canvas>
			</div>
		</div>
	</div>
</div>

{% endblock body %}

{% block javascripts %}
{% javascripts 
'@CMSAdminBundle/Resources/public/js/Chart.js/Chart.min.js'
%}
    <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
<script src="http://localhost:3232/socket.io/socket.io.js"></script>
<script>
$(function() { 
	var last_li = $('.nav-full-height ul li:last > a > i').html();
	var dataChart = '';
	var socket = io.connect('http://localhost:3232');
	socket.on('wdgt_content', function (data) {
	    $('#nb_content').html(data.nb_contents);
	    $('#nb_categories').html(data.nb_categories);
	    $('#unread').html(data.nb_contacts_unread);
	    $('#read').html(data.nb_contacts_read+data.nb_contacts_unread);
	    $('.nav-full-height ul li:last > a > i').before('<span class="badge badge-important">' + data.nb_contacts_unread + '</span>');
	    dataChart = data.contacts;
	});


	socket.on('wdgt_contact', function (data) {
		var ctx = document.getElementById("chartMsg").getContext("2d");

		var months = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
		var labelsChart = [];
		var dataChartNumber = []
		for(k in data) {
			labelsChart.push(months[data[k].month-1]);
			dataChartNumber.push(data[k].nb_messages);
		}

		var dataChart = {
			labels : labelsChart,
			datasets : [
						{
							fillColor : "rgba(220,220,220,0.5)",
							strokeColor : "rgba(220,220,220,1)",
							pointColor : "rgba(220,220,220,1)",
							pointStrokeColor : "#fff",
							data : dataChartNumber
						}
					]
		}

		new Chart(ctx).Line(dataChart);
	
	});
})


</script>
{% endblock %}
