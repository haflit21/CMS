{% extends('::admin.html.twig') %}
{% block title %}{% trans %}Content Manager{% endtrans %}{% endblock %}
{% block body %}

	<div class="row-fluid">
		<div class="span12">
			<h1 class="pull-left">{% trans %}Content Manager{% endtrans %}</h1>
			<a href="#myModal" role="button" class="btn btn-new btn-small pull-right" data-toggle="modal"><i class="icon icon-plus-sign"></i> {% trans %}New{% endtrans %}</a>
				<div class="modal hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<form action="{{ path('contents_new', {'lang' : defaultLanguage.id }) }}" mathod="post">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
							<h3 id="myModalLabel">Choose your content type</h3>
						</div>
						<div class="modal-body">
							{{ contentType|raw }}
						</div>
						<div class="modal-footer">
							<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
							<input class="btn btn-primary" type="submit" value="New" />
						</div>
					</form>
				</div>
			{% for flashMessage in app.session.flashbag.get('info') %}
			    <div class="alert alert-info">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Notice</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}
			{% for flashMessage in app.session.flashbag.get('error') %}
			    <div class="alert alert-error">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Error</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}

			{% if display %}


			    <div class="clear h20"></div>
				<form action="{{ path('contents') }}" method="post" id="form-main">
				<table class="table table-striped table-hover tablesorter">
		            <thead>
		                <tr>
		                  	<th>{% trans %}Title{% endtrans %}</th>
		                  	<th>{% trans %}Type{% endtrans %}</th>
		                  	<th>{% trans %}Language{% endtrans %}</th>
		                  	<th>{% trans %}Translations{% endtrans %}</th>
		                  	<th class="published">{% trans %}Published{% endtrans %}</th>
		                  	<th>{% trans %}Created{% endtrans %}</th>
		                  	<th>{% trans %}Actions{% endtrans %}</th>
		                </tr>
		            </thead>
		            <tbody>
		              	{% for content in pagination %}
		              		{% set cid = content.id %}
			                {% set found = false %}
			                {% set class = "" %}
			                {% if loop.index %2 == 0 or loop.index == 0 %}
			                	{% set class = ' class=odd' %}
			                {% endif %}
			              	<tr{{ class }}>
			                  	<td class="title first">
			                  		<a href="{{ path('contents_edit', {'id' : content.id }) }}">
			                  			{{ content.title }}
			                  		</a>
			                  	</td>
			                  	<td class="center-text">
			                  		{% if content.contenttype is defined %}
			                  			{{ content.contenttype }}
			                  		{% endif %}
			                  	</td>
			                  	<td class="center-text"><img src="{{ asset('bundles/cmscontent/img/flags/'~content.language.iso~'.png') }}" height="16px" style="height:16px;" alt="{{ content.language.iso }}">
			                  	</td>
			                  	<td class="center-text">
			                  		{% for language in languages %}
			                  			{% for translation in content.taxonomy.contents %}
			                  				{% if language.id == translation.language.id %}
			                  					{% set found = loop.index %}
			                  				{% endif %}
			                  			{% endfor %}
				                  		{% if found != false %}
				                  			{% set found = found - 1 %}
				                  			<a href="{{ path('contents_edit', { 'id' : content.taxonomy.contents[found].id }) }}" class="flag-element">
				                  				<img src="{{ asset('bundles/cmscontent/img/flags/'~language.iso~'.png') }}" class="flag" alt="{{ language.iso }}" height="16px"  style="height:16px;">
				                  				<img src="{{ asset('bundles/cmscontent/img/flags/flag-ok.png') }}" class="flag-ok" alt="{{ language.iso }}">
				                  			</a>
				                  		{% else %}
				                  			<a href="{{ path('contents_translation', {'lang' : language.id, 'reference': content.id, 'contenttype': content.contenttype.id }) }}">
				                  				<img src="{{ asset('bundles/cmscontent/img/flags/'~language.iso~'.png') }}" class="flag" alt="{{ language.iso }}" height="16px"  style="height:16px;">
				                  			</a>
				                  		{% endif %}
			                			{% set found = false %}
			                  		{% endfor %}
			                  	</td>
			                  	<td class="center-text">
			                  		<a href="{{ path('contents_published', {'id' : content.id }) }}">
					                  	{% if content.published %}
					                  		<i class="icon-ok"></i>
					                  	{% else %}
					                  		<i class="icon-ban-circle"></i>
					                  	{% endif %}
				                  	</a>
				                </td>
			                  	<td class="center-text">
			                  		{{ content.created|date('d/m/Y') }}
			                  	</td>
			                  	<td class="center-text last">
			                  		<a href="{{ path('contents_edit', {'id' : content.id }) }}"><i class="icon-edit"></i></a>
			                  		<a href="{{ path('contents_delete', {'id' : content.id }) }}"><i class="icon-trash"></i></a>
			                  		{# if content.translations|length > 0 %}
			                  		<a href="#manageTranslation" role="button" data-toggle="modal"><i class="icon-globe"></i></a>

									{% endif #}
			                  	</td>
			                </tr>
						{% endfor %}
		            </tbody>
		            <tfoot>
		            	<tr>
		            		<td>{% trans %}Total{% endtrans %} : {{ total }} {% trans %}content(s){% endtrans %}</td>
		            		<td colspan="6">
		            			{% trans %}Afficher{% endtrans %} :
				    			<select name="filter[display]" onchange="this.form.submit()">
				    				{% for i in options_pagination %}
				    					{% if i == nb %}
				    					<option value="{{ i }}" selected="selected">{{ i }} {% trans %}elements{% endtrans %}</option>
				    					{% else %}
				    					<option value="{{ i }}">{{ i }} {% trans %}elements{% endtrans %}</option>
				    					{% endif %}
				    				{% endfor %}
				    			</select>
				    		</td>
		            	</tr>
		            </tfoot>
		        </table>
		    </form>
		    {% endif %}
		    <div class="navigation">
			    {{ knp_pagination_render(pagination) }}
			</div>
	    </div>
	</div>

<div class="modal hide fade" id="manageTranslation" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="myModalLabel">Manage Translations</h3>
	</div>
	<div class="modal-body">
		<table class="table table-striped table-bordered tableborder">
				<thead>
                <tr>
                  	<th>#</th>
                  	<th>Title</th>
                  	<th>Type</th>
                  	<th>Published</th>
                  	<th>Created</th>
                  	<th>Action</th>
                </tr>
            </thead>
            <tbody>
            	{# for language in languages %}
          			{% for translation in content.taxonomy.contents %}
          				{% if language.id == translation.language.id %}
          					{% set found = loop.index %}
          				{% endif %}
          			{% endfor %}
              		{% if found != false %}
              			{% set found = found - 1 %}
		      				<tr>
			                	<td class="center-text">
			                  		{{ loop.index }}
			                	</td>
		                  		<td>
		                  			<a href="{{ path('contents_edit', {'id' : content.taxonomy.contents[found].id }) }}">
		                  				{{ content.taxonomy.contents[found].title }}
		                  			</a>
		                  		</td>
		                  		<td class="center-text">
		                  			{% if content.taxonomy.contents[found].taxonomy is defined %}
		                  				{% for taxonomy in content.taxonomy.contents[found].taxonomy %}
		                  					{{ taxonomy.title }}
		                  				{% endfor %}
		                  			{% endif %}
		                  		</td>
		                  		<td class="center-text">
			                  		<a href="{{ path('contents_published', {'id' : content.taxonomy.contents[found].id }) }}">
					                  	{% if content.taxonomy.contents[found].published %}
					                  		<i class="icon-ok"></i>
					                  	{% else %}
					                  		<i class="icon-ban-circle"></i>
					                  	{% endif %}
				                  	</a>
				                </td>
			                  	<td class="center-text">
			                  		{{ content.taxonomy.contents[found].created|date('d/m/Y') }}
			                  	</td>
			                  	<td class="center-text">
			                  		<a href="{{ path('contents_edit', {'id' : content.taxonomy.contents[found].id }) }}"><i class="icon-pencil"></i></a>
			                  		<a href="{{ path('contents_delete', {'id' : content.taxonomy.contents[found].id }) }}"><i class="icon-trash"></i></a>
			                  	</td>
			                </tr>
	      			{% endif %}
					{% set found = false %}
  				{% endfor #}
	  		</tbody>
	    </table>
	</div>
</div>
{% endblock body %}
{% block javascripts %}
<script type="text/javascript">
	$('.tablesorter').tablesorter({
		dateFormat: 'uk',
		headers: {
	    	2: {sorter: false},
	    	3: {sorter: false},
	    	5: {sorter: "shortDate"},
	    	6: {sorter: false }
		},
		cssAsc: 'headerSortUp',
		cssDesc: 'headerSortDown'
	});

	$(function() {
		$('table select').selectBoxIt();
	});
</script>
{% endblock %}
