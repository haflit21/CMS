{% extends('::admin.html.twig') %}
{% block title %}{% trans %}Menus{% endtrans %} - {{ menu_taxonomy.name }}{% endblock %}
{% block body %}

	<div class="row-fluid">
		<div class="span12">
			<h1 class="pull-left">{% trans %}Menus{% endtrans %} - {{ menu_taxonomy.name }}</h1>
			<a href="{{ path('entries_new', {'lang' : defaultLanguage.id, 'menu_taxonomy' : menu_taxonomy.id }) }}" class="btn btn-new btn-small pull-right"><i class="icon icon-plus-sign"></i> {% trans %}New{% endtrans %}</a>

			{% for flashMessage in app.session.flashbag.get('info') %}
				<div class="clear h20"></div>
			    <div class="alert alert-info">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Notice</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}
			{% for flashMessage in app.session.flashbag.get('error') %}
				<div class="clear h20"></div>
			    <div class="alert alert-error">
			    	<button class="close" data-dismiss="alert" type="button">×</button>
			        <strong>Error</strong>
			        {{ flashMessage }}
			    </div>
			{% endfor %}

			<div class="clear h20"></div>
			<form action="{{ path('entries_list', {'id': menu_taxonomy.id, 'page': 1}) }}" method="post" id="form-main">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>Id</th>
							<th>{% trans %}Title{% endtrans %}</th>
							<th class="center-text">{% trans %}Language{% endtrans %}</th>
							<th class="center-text">{% trans %}Translations{% endtrans %}</th>
							<th class="center-text">{% trans %}Order{% endtrans %}</th>
							<th class="center-text">{% trans %}Default{% endtrans %}</th>
							<th>{% trans %}State{% endtrans %}</th>
							<th colspan="2" width="8%">{% trans %}Actions{% endtrans %}</th>
						</tr>
					</thead>
					<tbody>
						{% for entry in pagination %}
						{% set found = false %}
						{% if not entry.isRoot %}
						<tr>
							<td>{{ entry.id }}</td>
							<td>
								<span class="left-{{ entry.level-1 }}"><a href="{{ path('entries_edit', {'id': entry.id }) }}">{{ entry.title }}</a></span>
							</td>
							<td class="center-text"><img src="{{ asset('bundles/cmscontent/img/flags/'~entry.language.iso~'.png') }}" height="16px" style="height:16px;" alt="{{ entry.language.iso }}">
							<td class="center-text">
		                  		{% for language in languages %}
		                  			{% for translation in entry.translations %}
		                  				{% if language.id == translation.language.id %}
		                  					{% set found = loop.index %}
		                  				{% endif %}
		                  			{% endfor %}
			                  		{% if found != false %}
			                  			{% set found = found - 1 %}
			                  			<a href="{{ path('entry_edit', { 'id' : entry.translations[found].id }) }}" class="flag-element">
			                  				<img src="{{ asset('bundles/cmscontent/img/flags/'~language.iso~'.png') }}" class="flag" alt="{{ language.iso }}" height="16px"  style="height:16px;">
			                  				<img src="{{ asset('bundles/cmscontent/img/flags/flag-ok.png') }}" class="flag-ok" alt="{{ language.iso }}">
			                  			</a>
			                  		{% else %}
			                  			<a href="{{ path('entries_translation', {'lang' : language.id, 'reference': entry.id }) }}">
			                  				<img src="{{ asset('bundles/cmscontent/img/flags/'~language.iso~'.png') }}" class="flag" alt="{{ language.iso }}" height="16px"  style="height:16px;">
			                  			</a>
			                  		{% endif %}
		                			{% set found = false %}
		                  		{% endfor %}
		                  	</td>
		                  	<td class="center-text">
		                  		<a href="{{ path('entries_move', {'id': entry.id, 'direction': 'UP'}) }}"><i class="icon-chevron-up"></i></a>
		                  		<a href="{{ path('entries_move', {'id': entry.id, 'direction': 'DOWN'}) }}"><i class="icon-chevron-down"></i></a>
		                  	</td>
							<td class="center-text">
								{% if entry.defaultPage %}
									<i class="icon-star"></i>
								{% else %}
									<i class="icon-star-empty"></i>
								{% endif %}
							<td>
								{% if entry.published %}
									<a href="javascript:" onclick="publish({{ entry.id }},0);" class="icon-ok"></a>
								{% else %}
									<a href="javascript:" onclick="publish({{ entry.id }},1);" class="icon-remove"></a>
								{% endif %}
							</td>
							<td>
								<a href="{{ path('entries_edit', {'id': entry.id, 'menu_taxonomy': menu_taxonomy }) }}" class="icon-edit"></a>
							</td>
							<td>
								<a href="#myModal-{{ entry.id }}" data-toggle="modal" class="icon-trash"> </a>
								<div class="modal hide" id="myModal-{{ entry.id }}">
									<div class="modal-header">
								    	<button type="button" class="close" data-dismiss="modal">×</button>
								    	<h3>Suppression du menu ?</h3>
								    </div>
								    <div class="modal-body">
								    	<p>Voulez-vous supprimer ce menu ?</p>
								    </div>
								    <div class="modal-footer">
								    	<a href="#" class="btn" data-dismiss="modal">Non</a>
								    	<a href="#" class="btn btn-primary">Oui</a>
								    </div>
								</div>
							</td>
						</tr>
						{% endif %}
						{% endfor %}
					</tbody>
					<tfoot>
		            	<tr>
		            		<td>{% trans %}Total{% endtrans %} : {{ total }} {% trans %}menu(s){% endtrans %}</td>
		            		<td colspan="6">
		            			{% trans %}Afficher{% endtrans %} :
				    			<select name="filter[display]" onchange="this.form.submit()">
				    				{% for i in options_pagination %}
				    					{% if i == nb %}
				    					<option value="{{ i }}" selected="selected">{{ i }} {% trans %}elements{% endtrans %}</option>
				    					{% else %}
				    					<option value="{{ i }}">{{ i }} {% trans %}elements{% endtrans %}</option>
				    					{% endif %}
				    				{% endfor %}
				    			</select>
				    		</td>
		            	</tr>
		            </tfoot>
				</table>
			</form>
			<div class="navigation">
			    {{ knp_pagination_render(pagination) }}
			</div>
		</div>
	</div>
{% endblock body %}
{% block javascripts %}
<script type="text/javascript">
	$(function() {
		$('select').selectBoxIt();
	});
</script>
{% endblock %}